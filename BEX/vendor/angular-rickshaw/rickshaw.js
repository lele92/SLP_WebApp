"use strict";angular.module("angular-rickshaw",[]).directive("rickshaw",["$compile","$window",function(e,r){return{restrict:"EA",scope:{options:"=rickshawOptions",series:"=rickshawSeries",features:"=rickshawFeatures"},link:function(a,i,t){function s(){p.setSize(),p.render()}function n(e){var r=e.data,a=e.series;return e.series?void a.forEach(function(e){var a=e.key||e.name;if(!a)throw"series needs a key or a name";r.forEach(function(r){var i=r.key||r.name;if(!i)throw"data needs a key or a name";if(a==i){var t=["color","name","data"];t.forEach(function(a){r[a]&&(e[a]=r[a])})}})}):r}function o(){p&&g&&(n({data:a.series,series:g.series}),s())}function f(){if(p){if(a.options){for(var r in a.options)g[r]=a.options[r],console.log(r+"="+a.options[r]);g.element=u[0]}p.configure(g)}else c=angular.element(i),c.append(u),c.empty(),u=e("<div></div>")(a),c.append(u),g=angular.copy(a.options),g.element=u[0],g.series=a.series,p=new Rickshaw.Graph(g);if(a.features){if(a.features.hover){var t={graph:p};t.xFormatter=a.features.hover.xFormatter,t.yFormatter=a.features.hover.yFormatter,t.formatter=a.features.hover.formatter;{new Rickshaw.Graph.HoverDetail(t)}}if(a.features.palette)for(var n=new Rickshaw.Color.Palette({scheme:a.features.palette}),o=0;o<g.series.length;o++)g.series[o].color=n.color()}if(s(),a.features){if(a.features.xAxis){var f={graph:p};if(a.features.xAxis.timeUnit){var m=new Rickshaw.Fixtures.Time;f.timeUnit=m.unit(a.features.xAxis.timeUnit),l||(l=new Rickshaw.Graph.Axis.Time(f),l.render())}else l||(l=new Rickshaw.Graph.Axis.X(f),l.render())}if(a.features.yAxis){var d={graph:p};a.features.yAxis.tickFormat&&(d.tickFormat=Rickshaw.Fixtures.Number[a.features.yAxis.tickFormat]),w||(w=new Rickshaw.Graph.Axis.Y(d),w.render())}if(a.features.legend){if(!h){h=e("<div></div>")(a),c.append(h);var k=new Rickshaw.Graph.Legend({graph:p,element:h[0]});if(a.features.legend.toggle){new Rickshaw.Graph.Behavior.Series.Toggle({graph:p,legend:k})}if(a.features.legend.highlight){new Rickshaw.Graph.Behavior.Series.Highlight({graph:p,legend:k})}}}else h&&(h.remove(),h=null)}}var c,u,h,l,w,p,g,m=a.$watch("options",function(e,r){angular.equals(e,r)||f()},!0),d=a.$watchCollection("series",function(e,r){angular.equals(e,r)||o()},!0),k=a.$watch("features",function(e,r){angular.equals(e,r)||f()},!0);a.$on("$destroy",function(){m(),d(),k()}),angular.element(r).on("resize",function(){a.$broadcast("rickshaw::resize")}),a.$on("rickshaw::resize",function(){s()}),f()},controller:function(e,r,a){}}}]);